<div class="container">
    
    <h1>{{#if title}}{{title}}{{else}}Product List{{/if}}</h1>

    <div class="row section">
        <a href="/product/add" class="btn waves-effect waves-light blue">
            Add New Product
            <i class="material-icons right">add</i>
        </a>

        <a class="btn waves-effect waves-light green" href="/product/sort/asc">
            Name Ascending
            <i class="material-icons right">arrow_upward</i>
        </a>

        <a class="btn waves-effect waves-light lime darken-2" href="/product/sort/desc">
            Name Descending
            <i class="material-icons right">arrow_downward</i>
        </a>
    </div> 
  

    <div class="row">

        <form action="/product/search" method="post" class="col s12 m6 l5">
            <div class="input-field">
                <i class="material-icons prefix">search</i>
                <input id="search-input" type="search" name="keyword" placeholder="Search by name..." required>
                <label for="search-input"></label>
            </div>
        </form>

        <form action="/product" method="get" class="col s12 m6 l5">
            <div class="input-field">
                <select name="category" onchange="this.form.submit()">
                    <option value="all" {{#unless selectedCategory}}selected{{/unless}}>All Categories</option>

                    {{#each categoryList}}
                        <option value="{{this._id}}"
                            {{#equals this._id ../selectedCategory}}selected{{/equals}}>
                            {{this.name}}
                        </option>
                    {{/each}}
                </select>
                <label>Filter by Category</label>
            </div>
        </form>
    </div>

    <table class="table responsive-table striped highlight">
        <thead>
            <tr>
                <th>Name</th>
                <th>Image</th>
                <th>Description</th>
                <th>Category</th>
                <th>Price</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {{#each productList }}
            <tr>
                <td>{{ name }}</td>
                <td>
                    <img src="/images/{{ image }}" alt="{{ name }}" class="product-image materialboxed">
                </td>
                <td>{{ description }}</td>
                <td>{{ category.name }}</td>
                <td>{{ price }} Ä‘</td>
                <td>
                    <a href="/product/edit/{{_id}}"
                       class="btn-small waves-effect waves-light amber darken-2">
                       Edit
                    </a>
                    <a href="/product/delete/{{_id}}"
                       class="btn-small waves-effect waves-light red"
                       onclick="return confirm('Do you want to delete this product?')">
                       Delete
                    </a>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>

<style>
    .product-image {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 4px;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var elems_materialbox = document.querySelectorAll('.materialboxed');
        M.Materialbox.init(elems_materialbox);

        var elems_select = document.querySelectorAll('select');
        M.FormSelect.init(elems_select);
    });
</script>